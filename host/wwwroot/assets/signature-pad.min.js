!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.SignaturePad=b()}(this,function(){"use strict";function a(a,b,c){this.x=a,this.y=b,this.time=c||(new Date).getTime()}function b(a,b,c,d){this.startPoint=a,this.control1=b,this.control2=c,this.endPoint=d}function c(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=!1===c.leading?0:Date.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=Date.now();h||!1!==c.leading||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||!1===c.trailing||(g=setTimeout(i,k)),f}}function d(a,b){var e=this,f=b||{};this.velocityFilterWeight=f.velocityFilterWeight||.7,this.minWidth=f.minWidth||.5,this.maxWidth=f.maxWidth||2.5,this.throttle="throttle"in f?f.throttle:16,this.throttle?this._strokeMoveUpdate=c(d.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=d.prototype._strokeUpdate,this.dotSize=f.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=f.penColor||"black",this.backgroundColor=f.backgroundColor||"rgba(0,0,0,0)",this.onBegin=f.onBegin,this.onEnd=f.onEnd,this._canvas=a,this._ctx=a.getContext("2d"),this.clear(),this._handleMouseDown=function(a){1===a.which&&(e._mouseButtonDown=!0,e._strokeBegin(a))},this._handleMouseMove=function(a){e._mouseButtonDown&&e._strokeMoveUpdate(a)},this._handleMouseUp=function(a){1===a.which&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(a))},this._handleTouchStart=function(a){if(1===a.targetTouches.length){var b=a.changedTouches[0];e._strokeBegin(b)}},this._handleTouchMove=function(a){a.preventDefault();var b=a.targetTouches[0];e._strokeMoveUpdate(b)},this._handleTouchEnd=function(a){a.target===e._canvas&&(a.preventDefault(),e._strokeEnd(a))},this.on()}return a.prototype.velocityFrom=function(a){return this.time!==a.time?this.distanceTo(a)/(this.time-a.time):1},a.prototype.distanceTo=function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},b.prototype.length=function(){for(var a=10,b=0,c=void 0,d=void 0,e=0;e<=a;e+=1){var f=e/a,g=this._point(f,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),h=this._point(f,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(e>0){var i=g-c,j=h-d;b+=Math.sqrt(i*i+j*j)}c=g,d=h}return b},b.prototype._point=function(a,b,c,d,e){return b*(1-a)*(1-a)*(1-a)+3*c*(1-a)*(1-a)*a+3*d*(1-a)*a*a+e*a*a*a},d.prototype.clear=function(){var a=this._ctx,b=this._canvas;a.fillStyle=this.backgroundColor,a.clearRect(0,0,b.width,b.height),a.fillRect(0,0,b.width,b.height),this._data=[],this._reset(),this._isEmpty=!0},d.prototype.fromDataURL=function(a){var b=this,c=new Image,d=window.devicePixelRatio||1,e=this._canvas.width/d,f=this._canvas.height/d;this._reset(),c.src=a,c.onload=function(){b._ctx.drawImage(c,0,0,e,f)},this._isEmpty=!1},d.prototype.toDataURL=function(a){var b;switch(a){case"image/svg+xml":return this._toSVG();default:for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return(b=this._canvas).toDataURL.apply(b,[a].concat(d))}},d.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},d.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},d.prototype.isEmpty=function(){return this._isEmpty},d.prototype._strokeBegin=function(a){this._data.push([]),this._reset(),this._strokeUpdate(a),"function"==typeof this.onBegin&&this.onBegin(a)},d.prototype._strokeUpdate=function(a){var b=a.clientX,c=a.clientY,d=this._createPoint(b,c),e=this._addPoint(d),f=e.curve,g=e.widths;f&&g&&this._drawCurve(f,g.start,g.end),this._data[this._data.length-1].push({x:d.x,y:d.y,time:d.time})},d.prototype._strokeEnd=function(a){var b=this.points.length>2,c=this.points[0];!b&&c&&this._drawDot(c),"function"==typeof this.onEnd&&this.onEnd(a)},d.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},d.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},d.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},d.prototype._createPoint=function(b,c,d){var e=this._canvas.getBoundingClientRect();return new a(b-e.left,c-e.top,d||(new Date).getTime())},d.prototype._addPoint=function(a){var c=this.points,d=void 0;if(c.push(a),c.length>2){3===c.length&&c.unshift(c[0]),d=this._calculateCurveControlPoints(c[0],c[1],c[2]);var e=d.c2;d=this._calculateCurveControlPoints(c[1],c[2],c[3]);var f=d.c1,g=new b(c[1],e,f,c[2]),h=this._calculateCurveWidths(g);return c.shift(),{curve:g,widths:h}}return{}},d.prototype._calculateCurveControlPoints=function(b,c,d){var e=b.x-c.x,f=b.y-c.y,g=c.x-d.x,h=c.y-d.y,i={x:(b.x+c.x)/2,y:(b.y+c.y)/2},j={x:(c.x+d.x)/2,y:(c.y+d.y)/2},k=Math.sqrt(e*e+f*f),l=Math.sqrt(g*g+h*h),m=i.x-j.x,n=i.y-j.y,o=l/(k+l),p={x:j.x+m*o,y:j.y+n*o},q=c.x-p.x,r=c.y-p.y;return{c1:new a(i.x+q,i.y+r),c2:new a(j.x+q,j.y+r)}},d.prototype._calculateCurveWidths=function(a){var b=a.startPoint,c=a.endPoint,d={start:null,end:null},e=this.velocityFilterWeight*c.velocityFrom(b)+(1-this.velocityFilterWeight)*this._lastVelocity,f=this._strokeWidth(e);return d.start=this._lastWidth,d.end=f,this._lastVelocity=e,this._lastWidth=f,d},d.prototype._strokeWidth=function(a){return Math.max(this.maxWidth/(a+1),this.minWidth)},d.prototype._drawPoint=function(a,b,c){var d=this._ctx;d.moveTo(a,b),d.arc(a,b,c,0,2*Math.PI,!1),this._isEmpty=!1},d.prototype._drawCurve=function(a,b,c){var d=this._ctx,e=c-b,f=Math.floor(a.length());d.beginPath();for(var g=0;g<f;g+=1){var h=g/f,i=h*h,j=i*h,k=1-h,l=k*k,m=l*k,n=m*a.startPoint.x;n+=3*l*h*a.control1.x,n+=3*k*i*a.control2.x,n+=j*a.endPoint.x;var o=m*a.startPoint.y;o+=3*l*h*a.control1.y,o+=3*k*i*a.control2.y,o+=j*a.endPoint.y;var p=b+j*e;this._drawPoint(n,o,p)}d.closePath(),d.fill()},d.prototype._drawDot=function(a){var b=this._ctx,c="function"==typeof this.dotSize?this.dotSize():this.dotSize;b.beginPath(),this._drawPoint(a.x,a.y,c),b.closePath(),b.fill()},d.prototype._fromData=function(b,c,d){for(var e=0;e<b.length;e+=1){var f=b[e];if(f.length>1)for(var g=0;g<f.length;g+=1){var h=f[g],i=new a(h.x,h.y,h.time);if(0===g)this._reset(),this._addPoint(i);else if(g!==f.length-1){var j=this._addPoint(i),k=j.curve,l=j.widths;k&&l&&c(k,l)}}else{this._reset();d(f[0])}}},d.prototype._toSVG=function(){var a=this,b=this._data,c=this._canvas,d=Math.max(window.devicePixelRatio||1,1),e=0,f=0,g=c.width/d,h=c.height/d,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS(null,"width",c.width),i.setAttributeNS(null,"height",c.height),this._fromData(b,function(b,c){var d=document.createElement("path");if(!(isNaN(b.control1.x)||isNaN(b.control1.y)||isNaN(b.control2.x)||isNaN(b.control2.y))){var e="M "+b.startPoint.x.toFixed(3)+","+b.startPoint.y.toFixed(3)+" C "+b.control1.x.toFixed(3)+","+b.control1.y.toFixed(3)+" "+b.control2.x.toFixed(3)+","+b.control2.y.toFixed(3)+" "+b.endPoint.x.toFixed(3)+","+b.endPoint.y.toFixed(3);d.setAttribute("d",e),d.setAttribute("stroke-width",(2.25*c.end).toFixed(3)),d.setAttribute("stroke",a.penColor),d.setAttribute("fill","none"),d.setAttribute("stroke-linecap","round"),i.appendChild(d)}},function(b){var c=document.createElement("circle"),d="function"==typeof a.dotSize?a.dotSize():a.dotSize;c.setAttribute("r",d),c.setAttribute("cx",b.x),c.setAttribute("cy",b.y),c.setAttribute("fill",a.penColor),i.appendChild(c)});var j="data:image/svg+xml;base64,",k='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="'+e+" "+f+" "+g+" "+h+'" width="'+g+'" height="'+h+'">',l=i.innerHTML;if(void 0===l){var m=document.createElement("dummy"),n=i.childNodes;m.innerHTML="";for(var o=0;o<n.length;o+=1)m.appendChild(n[o].cloneNode(!0));l=m.innerHTML}var p="</svg>",q=k+l+p;return j+btoa(q)},d.prototype.fromData=function(a){var b=this;this.clear(),this._fromData(a,function(a,c){return b._drawCurve(a,c.start,c.end)},function(a){return b._drawDot(a)})},d.prototype.toData=function(){return this._data},d});