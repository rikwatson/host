"use strict";function indexOf(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function Instruction(a,b){this.type=a,this.value=void 0!==b&&null!==b?b:0}function Expression(a,b){this.tokens=a,this.parser=b,this.unaryOps=b.unaryOps,this.binaryOps=b.binaryOps,this.ternaryOps=b.ternaryOps,this.functions=b.functions}function escapeValue(a){return"string"==typeof a?JSON.stringify(a).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):a}function simplify(a,b,c,d,e){for(var h,i,j,k,f=[],g=[],l=0,m=a.length;l<m;l++){var n=a[l],o=n.type;if(o===INUMBER)f.push(n);else if(o===IVAR&&e.hasOwnProperty(n.value))n=new Instruction(INUMBER,e[n.value]),f.push(n);else if(o===IOP2&&f.length>1)i=f.pop(),h=f.pop(),k=c[n.value],n=new Instruction(INUMBER,k(h.value,i.value)),f.push(n);else if(o===IOP3&&f.length>2)j=f.pop(),i=f.pop(),h=f.pop(),"?"===n.value?f.push(h.value?i.value:j.value):(k=d[n.value],n=new Instruction(INUMBER,k(h.value,i.value,j.value)),f.push(n));else if(o===IOP1&&f.length>0)h=f.pop(),k=b[n.value],n=new Instruction(INUMBER,k(h.value)),f.push(n);else if(o===IEXPR){for(;f.length>0;)g.push(f.shift());g.push(new Instruction(IEXPR,simplify(n.value,b,c,d,e)))}else if(o===IMEMBER&&f.length>0)h=f.pop(),f.push(new Instruction(INUMBER,h.value[n.value]));else{for(;f.length>0;)g.push(f.shift());g.push(n)}}for(;f.length>0;)g.push(f.shift());return g}function substitute(a,b,c){for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e],h=g.type;if(h===IVAR&&g.value===b)for(var i=0;i<c.tokens.length;i++){var k,j=c.tokens[i];k=j.type===IOP1?unaryInstruction(j.value):j.type===IOP2?binaryInstruction(j.value):j.type===IOP3?ternaryInstruction(j.value):new Instruction(j.type,j.value),d.push(k)}else h===IEXPR?d.push(new Instruction(IEXPR,substitute(g.value,b,c))):d.push(g)}return d}function evaluate(a,b,c){for(var e,f,g,h,d=[],i=0,j=a.length;i<j;i++){var k=a[i],l=k.type;if(l===INUMBER)d.push(k.value);else if(l===IOP2)f=d.pop(),e=d.pop(),h=b.binaryOps[k.value],d.push(h(e,f));else if(l===IOP3)g=d.pop(),f=d.pop(),e=d.pop(),"?"===k.value?d.push(evaluate(e?f:g,b,c)):(h=b.ternaryOps[k.value],d.push(h(e,f,g)));else if(l===IVAR)if(k.value in b.functions)d.push(b.functions[k.value]);else{var m=c[k.value];if(void 0===m)throw new Error("undefined variable: "+k.value);d.push(m)}else if(l===IOP1)e=d.pop(),h=b.unaryOps[k.value],d.push(h(e));else if(l===IFUNCALL){for(var n=k.value,o=[];n-- >0;)o.unshift(d.pop());if(h=d.pop(),!h.apply||!h.call)throw new Error(h+" is not a function");d.push(h.apply(void 0,o))}else if(l===IEXPR)d.push(k.value);else{if(l!==IMEMBER)throw new Error("invalid Expression");e=d.pop(),d.push(e[k.value])}}if(d.length>1)throw new Error("invalid Expression (parity)");return d[0]}function expressionToString(a,b){for(var d,e,f,g,c=[],h=0,i=a.length;h<i;h++){var j=a[h],k=j.type;if(k===INUMBER)"number"==typeof j.value&&j.value<0?c.push("("+j.value+")"):c.push(escapeValue(j.value));else if(k===IOP2)e=c.pop(),d=c.pop(),g=j.value,b?"^"===g?c.push("Math.pow("+d+", "+e+")"):"and"===g?c.push("(!!"+d+" && !!"+e+")"):"or"===g?c.push("(!!"+d+" || !!"+e+")"):"||"===g?c.push("(String("+d+") + String("+e+"))"):"=="===g?c.push("("+d+" === "+e+")"):"!="===g?c.push("("+d+" !== "+e+")"):c.push("("+d+" "+g+" "+e+")"):c.push("("+d+" "+g+" "+e+")");else if(k===IOP3){if(f=c.pop(),e=c.pop(),d=c.pop(),"?"!==(g=j.value))throw new Error("invalid Expression");c.push("("+d+" ? "+e+" : "+f+")")}else if(k===IVAR)c.push(j.value);else if(k===IOP1)d=c.pop(),g=j.value,"-"===g||"+"===g?c.push("("+g+d+")"):b?"not"===g?c.push("(!"+d+")"):"!"===g?c.push("fac("+d+")"):c.push(g+"("+d+")"):"!"===g?c.push("("+d+"!)"):c.push("("+g+" "+d+")");else if(k===IFUNCALL){for(var l=j.value,m=[];l-- >0;)m.unshift(c.pop());g=c.pop(),c.push(g+"("+m.join(", ")+")")}else if(k===IMEMBER)d=c.pop(),c.push(d+"."+j.value);else{if(k!==IEXPR)throw new Error("invalid Expression");c.push("("+expressionToString(j.value,b)+")")}}if(c.length>1)throw new Error("invalid Expression (parity)");return c[0]}function getSymbols(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];e.type===IVAR&&-1===indexOf(b,e.value)?b.push(e.value):e.type===IEXPR&&getSymbols(e.value,b)}}function add(a,b){return Number(a)+Number(b)}function sub(a,b){return a-b}function mul(a,b){return a*b}function div(a,b){return a/b}function mod(a,b){return a%b}function concat(a,b){return""+a+b}function equal(a,b){return a===b}function notEqual(a,b){return a!==b}function greaterThan(a,b){return a>b}function lessThan(a,b){return a<b}function greaterThanEqual(a,b){return a>=b}function lessThanEqual(a,b){return a<=b}function andOperator(a,b){return Boolean(a&&b)}function orOperator(a,b){return Boolean(a||b)}function sinh(a){return(Math.exp(a)-Math.exp(-a))/2}function cosh(a){return(Math.exp(a)+Math.exp(-a))/2}function tanh(a){return a===1/0?1:a===-1/0?-1:(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))}function asinh(a){return a===-1/0?a:Math.log(a+Math.sqrt(a*a+1))}function acosh(a){return Math.log(a+Math.sqrt(a*a-1))}function atanh(a){return Math.log((1+a)/(1-a))/2}function log10(a){return Math.log(a)*Math.LOG10E}function neg(a){return-a}function not(a){return!a}function trunc(a){return a<0?Math.ceil(a):Math.floor(a)}function random(a){return Math.random()*(a||1)}function factorial(a){return gamma(a+1)}function stringLength(a){return String(a).length}function hypot(){for(var a=0,b=0,c=0,d=arguments.length;c<d;c++){var f,e=Math.abs(arguments[c]);b<e?(f=b/e,a=a*f*f+1,b=e):e>0?(f=e/b,a+=f*f):a+=e}return b===1/0?1/0:b*Math.sqrt(a)}function condition(a,b,c){return a?b:c}function isInteger(a){return isFinite(a)&&a===Math.round(a)}function gamma(a){var b,c;if(isInteger(a)){if(a<=0)return isFinite(a)?1/0:NaN;if(a>171)return 1/0;for(var d=a-2,e=a-1;d>1;)e*=d,d--;return 0===e&&(e=1),e}if(a<.5)return Math.PI/(Math.sin(Math.PI*a)*gamma(1-a));if(a>=171.35)return 1/0;if(a>85){var f=a*a,g=f*a,h=g*a,i=h*a;return Math.sqrt(2*Math.PI/a)*Math.pow(a/Math.E,a)*(1+1/(12*a)+1/(288*f)-139/(51840*g)-571/(2488320*h)+163879/(209018880*i)+5246819/(75246796800*i*a))}--a,c=GAMMA_P[0];for(var j=1;j<GAMMA_P.length;++j)c+=GAMMA_P[j]/(a+j);return b=a+GAMMA_G+.5,Math.sqrt(2*Math.PI)*Math.pow(b,a+.5)*Math.exp(-b)*c}function Token(a,b,c,d){this.type=a,this.value=b,this.line=c,this.column=d}function TokenStream(a,b,c,d,e){this.pos=0,this.line=0,this.column=0,this.current=null,this.unaryOps=b,this.binaryOps=c,this.ternaryOps=d,this.consts=e,this.expression=a,this.savedPosition=0,this.savedCurrent=null,this.savedLine=0,this.savedColumn=0}function unaryInstruction(a){var b=unaryInstructionCache[a];return b||(b=unaryInstructionCache[a]=new Instruction(IOP1,a)),b}function binaryInstruction(a){var b=binaryInstructionCache[a];return b||(b=binaryInstructionCache[a]=new Instruction(IOP2,a)),b}function ternaryInstruction(a){var b=ternaryInstructionCache[a];return b||(b=ternaryInstructionCache[a]=new Instruction(IOP3,a)),b}function ParserState(a,b,c){this.parser=a,this.tokens=b,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==c.allowMemberAccess}function Parser(a){this.options=a||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||sinh,cosh:Math.cosh||cosh,tanh:Math.tanh||tanh,asinh:Math.asinh||asinh,acosh:Math.acosh||acosh,atanh:Math.atanh||atanh,sqrt:Math.sqrt,log:Math.log,ln:Math.log,lg:Math.log10||log10,log10:Math.log10||log10,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||trunc,"-":neg,"+":Number,exp:Math.exp,not:not,length:stringLength,"!":factorial},this.binaryOps={"+":add,"-":sub,"*":mul,"/":div,"%":mod,"^":Math.pow,"||":concat,"==":equal,"!=":notEqual,">":greaterThan,"<":lessThan,">=":greaterThanEqual,"<=":lessThanEqual,and:andOperator,or:orOperator},this.ternaryOps={"?":condition},this.functions={random:random,fac:factorial,min:Math.min,max:Math.max,hypot:Math.hypot||hypot,pyt:Math.hypot||hypot,pow:Math.pow,atan2:Math.atan2,if:condition,gamma:gamma},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}var INUMBER="INUMBER",IOP1="IOP1",IOP2="IOP2",IOP3="IOP3",IVAR="IVAR",IFUNCALL="IFUNCALL",IEXPR="IEXPR",IMEMBER="IMEMBER";Instruction.prototype.toString=function(){switch(this.type){case INUMBER:case IOP1:case IOP2:case IOP3:case IVAR:return this.value;case IFUNCALL:return"CALL "+this.value;case IMEMBER:return"."+this.value;default:return"Invalid Instruction"}},Expression.prototype.simplify=function(a){return a=a||{},new Expression(simplify(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,a),this.parser)},Expression.prototype.substitute=function(a,b){return b instanceof Expression||(b=this.parser.parse(String(b))),new Expression(substitute(this.tokens,a,b),this.parser)},Expression.prototype.evaluate=function(a){return a=a||{},evaluate(this.tokens,this,a)},Expression.prototype.toString=function(){return expressionToString(this.tokens,!1)},Expression.prototype.symbols=function(){var a=[];return getSymbols(this.tokens,a),a},Expression.prototype.variables=function(){var a=[];getSymbols(this.tokens,a);var b=this.functions;return a.filter(function(a){return!(a in b)})},Expression.prototype.toJSFunction=function(a,b){var c=this,d=new Function(a,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+expressionToString(this.simplify(b).tokens,!0)+"; }");return function(){return d.apply(c,arguments)}};var GAMMA_G=4.7421875,GAMMA_P=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22],TEOF="TEOF",TOP="TOP",TNUMBER="TNUMBER",TSTRING="TSTRING",TPAREN="TPAREN",TCOMMA="TCOMMA",TNAME="TNAME";Token.prototype.toString=function(){return this.type+": "+this.value},TokenStream.prototype.newToken=function(a,b,c,d){return new Token(a,b,null!=c?c:this.line,null!=d?d:this.column)},TokenStream.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current,this.savedLine=this.line,this.savedColumn=this.column},TokenStream.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent,this.line=this.savedLine,this.column=this.savedColumn},TokenStream.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(TEOF,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isComma()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},TokenStream.prototype.isString=function(){var a=!1,b=this.line,c=this.column,d=this.pos,e=this.expression.charAt(d);if("'"===e||'"'===e){this.pos++,this.column++;for(var f=this.expression.indexOf(e,d+1);f>=0&&this.pos<this.expression.length;){if(this.pos=f+1,"\\"!==this.expression.charAt(f-1)){var g=this.expression.substring(d+1,f);this.current=this.newToken(TSTRING,this.unescape(g),b,c);for(var h=g.indexOf("\n"),i=-1;h>=0;)this.line++,this.column=0,i=h,h=g.indexOf("\n",h+1);this.column+=g.length-i,a=!0;break}f=this.expression.indexOf(e,f+1)}}return a},TokenStream.prototype.isParen=function(){var a=this.expression.charAt(this.pos);return("("===a||")"===a)&&(this.current=this.newToken(TPAREN,a),this.pos++,this.column++,!0)},TokenStream.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(TCOMMA,","),this.pos++,this.column++,!0)},TokenStream.prototype.isConst=function(){for(var a=this.pos,b=a;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!==c&&"."!==c&&(c<"0"||c>"9")))break}if(b>a){var d=this.expression.substring(a,b);if(d in this.consts)return this.current=this.newToken(TNUMBER,this.consts[d]),this.pos+=d.length,this.column+=d.length,!0}return!1},TokenStream.prototype.isNamedOp=function(){for(var a=this.pos,b=a;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!==c&&(c<"0"||c>"9")))break}if(b>a){var d=this.expression.substring(a,b);if(d in this.binaryOps||d in this.unaryOps||d in this.ternaryOps)return this.current=this.newToken(TOP,d),this.pos+=d.length,this.column+=d.length,!0}return!1},TokenStream.prototype.isName=function(){for(var a=this.pos,b=a;b<this.expression.length;b++){var c=this.expression.charAt(b);if(c.toUpperCase()===c.toLowerCase()&&(b===this.pos||"_"!==c&&(c<"0"||c>"9")))break}if(b>a){var d=this.expression.substring(a,b);return this.current=this.newToken(TNAME,d),this.pos+=d.length,this.column+=d.length,!0}return!1},TokenStream.prototype.isWhitespace=function(){for(var a=!1,b=this.expression.charAt(this.pos);!(" "!==b&&"\t"!==b&&"\n"!==b&&"\r"!==b||(a=!0,this.pos++,this.column++,"\n"===b&&(this.line++,this.column=0),this.pos>=this.expression.length));)b=this.expression.charAt(this.pos);return a};var codePointPattern=/^[0-9a-f]{4}$/i;TokenStream.prototype.unescape=function(a){var b=a.indexOf("\\");if(b<0)return a;for(var c=a.substring(0,b);b>=0;){var d=a.charAt(++b);switch(d){case"'":c+="'";break;case'"':c+='"';break;case"\\":c+="\\";break;case"/":c+="/";break;case"b":c+="\b";break;case"f":c+="\f";break;case"n":c+="\n";break;case"r":c+="\r";break;case"t":c+="\t";break;case"u":var e=a.substring(b+1,b+5);codePointPattern.test(e)||this.parseError("Illegal escape sequence: \\u"+e),c+=String.fromCharCode(parseInt(e,16)),b+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+d+'"')}++b;var f=a.indexOf("\\",b);c+=a.substring(b,f<0?a.length:f),b=f}return c},TokenStream.prototype.isComment=function(){if("/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)){var b=this.pos;this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length);for(var c=this.expression.substring(b,this.pos),d=c.indexOf("\n");d>=0;)this.line++,this.column=c.length-d,d=c.indexOf("\n",d+1);return!0}return!1},TokenStream.prototype.isNumber=function(){for(var i,a=!1,b=this.pos,c=b,d=b,e=this.column,f=e,g=!1,h=!1;b<this.expression.length&&((i=this.expression.charAt(b))>="0"&&i<="9"||!g&&"."===i);)"."===i?g=!0:h=!0,b++,e++,a=h;if(a&&(d=b,f=e),"e"===i||"E"===i){b++,e++;for(var j=!0,k=!1;b<this.expression.length;){if(i=this.expression.charAt(b),!j||"+"!==i&&"-"!==i){if(!(i>="0"&&i<="9"))break;k=!0,j=!1}else j=!1;b++,e++}k||(b=d,e=f)}return a?(this.current=this.newToken(TNUMBER,parseFloat(this.expression.substring(c,b))),this.pos=b,this.column=e):(this.pos=d,this.column=f),a},TokenStream.prototype.isOperator=function(){var a=this.expression.charAt(this.pos);if("+"===a||"-"===a||"*"===a||"/"===a||"%"===a||"^"===a||"?"===a||":"===a||"."===a)this.current=this.newToken(TOP,a);else if("∙"===a||"•"===a)this.current=this.newToken(TOP,"*");else if(">"===a)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(TOP,">="),this.pos++,this.column++):this.current=this.newToken(TOP,">");else if("<"===a)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(TOP,"<="),this.pos++,this.column++):this.current=this.newToken(TOP,"<");else if("|"===a){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(TOP,"||"),this.pos++,this.column++}else if("="===a){if("="!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(TOP,"=="),this.pos++,this.column++}else{if("!"!==a)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(TOP,"!="),this.pos++,this.column++):this.current=this.newToken(TOP,a)}return this.pos++,this.column++,!0},TokenStream.prototype.parseError=function(a){throw new Error("parse error ["+(this.line+1)+":"+(this.column+1)+"]: "+a)};var unaryInstructionCache={},binaryInstructionCache={},ternaryInstructionCache={};ParserState.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},ParserState.prototype.tokenMatches=function(a,b){return void 0===b||(Array.isArray(b)?indexOf(b,a.value)>=0:"function"==typeof b?b(a):a.value===b)},ParserState.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},ParserState.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},ParserState.prototype.accept=function(a,b){return!(this.nextToken.type!==a||!this.tokenMatches(this.nextToken,b))&&(this.next(),!0)},ParserState.prototype.expect=function(a,b){if(!this.accept(a,b))throw new Error("parse error ["+this.tokens.line+":"+this.tokens.column+"]: Expected "+(b||a))},ParserState.prototype.parseAtom=function(a){if(this.accept(TNAME))a.push(new Instruction(IVAR,this.current.value));else if(this.accept(TNUMBER))a.push(new Instruction(INUMBER,this.current.value));else if(this.accept(TSTRING))a.push(new Instruction(INUMBER,this.current.value));else{if(!this.accept(TPAREN,"("))throw new Error("unexpected "+this.nextToken);this.parseExpression(a),this.expect(TPAREN,")")}},ParserState.prototype.parseExpression=function(a){this.parseConditionalExpression(a)},ParserState.prototype.parseConditionalExpression=function(a){for(this.parseOrExpression(a);this.accept(TOP,"?");){var b=[],c=[];this.parseConditionalExpression(b),this.expect(TOP,":"),this.parseConditionalExpression(c),a.push(new Instruction(IEXPR,b)),a.push(new Instruction(IEXPR,c)),a.push(ternaryInstruction("?"))}},ParserState.prototype.parseOrExpression=function(a){for(this.parseAndExpression(a);this.accept(TOP,"or");)this.parseAndExpression(a),a.push(binaryInstruction("or"))},ParserState.prototype.parseAndExpression=function(a){for(this.parseComparison(a);this.accept(TOP,"and");)this.parseComparison(a),a.push(binaryInstruction("and"))},ParserState.prototype.parseComparison=function(a){for(this.parseAddSub(a);this.accept(TOP,["==","!=","<","<=",">=",">"]);){var b=this.current;this.parseAddSub(a),a.push(binaryInstruction(b.value))}},ParserState.prototype.parseAddSub=function(a){for(this.parseTerm(a);this.accept(TOP,["+","-","||"]);){var b=this.current;this.parseTerm(a),a.push(binaryInstruction(b.value))}},ParserState.prototype.parseTerm=function(a){for(this.parseFactor(a);this.accept(TOP,["*","/","%"]);){var b=this.current;this.parseFactor(a),a.push(binaryInstruction(b.value))}},ParserState.prototype.parseFactor=function(a){function c(a){return a.value in b}var b=this.tokens.unaryOps;if(this.save(),this.accept(TOP,c))if("-"!==this.current.value&&"+"!==this.current.value&&this.nextToken.type===TPAREN&&"("===this.nextToken.value)this.restore(),this.parseExponential(a);else{var d=this.current;this.parseFactor(a),a.push(unaryInstruction(d.value))}else this.parseExponential(a)},ParserState.prototype.parseExponential=function(a){for(this.parsePostfixExpression(a);this.accept(TOP,"^");)this.parseFactor(a),a.push(binaryInstruction("^"))},ParserState.prototype.parsePostfixExpression=function(a){for(this.parseFunctionCall(a);this.accept(TOP,"!");)a.push(unaryInstruction("!"))},ParserState.prototype.parseFunctionCall=function(a){function c(a){return a.value in b}var b=this.tokens.unaryOps;if(this.accept(TOP,c)){var d=this.current;this.parseAtom(a),a.push(unaryInstruction(d.value))}else for(this.parseMemberExpression(a);this.accept(TPAREN,"(");)if(this.accept(TPAREN,")"))a.push(new Instruction(IFUNCALL,0));else{var e=this.parseArgumentList(a);a.push(new Instruction(IFUNCALL,e))}},ParserState.prototype.parseArgumentList=function(a){for(var b=0;!this.accept(TPAREN,")");)for(this.parseExpression(a),++b;this.accept(TCOMMA);)this.parseExpression(a),++b;return b},ParserState.prototype.parseMemberExpression=function(a){for(this.parseAtom(a);this.accept(TOP,".");){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(TNAME),a.push(new Instruction(IMEMBER,this.current.value))}},Parser.prototype.parse=function(a){var b=[],c=new ParserState(this,new TokenStream(a,this.unaryOps,this.binaryOps,this.ternaryOps,this.consts),{allowMemberAccess:this.options.allowMemberAccess});return c.parseExpression(b),c.expect(TEOF,"EOF"),new Expression(b,this)},Parser.prototype.evaluate=function(a,b){return this.parse(a).evaluate(b)};var sharedParser=new Parser;Parser.parse=function(a){return sharedParser.parse(a)},Parser.evaluate=function(a,b){return sharedParser.parse(a).evaluate(b)};